<!DOCTYPE html>
<html>

<head>
    <title>ZOS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="/style/style.css" rel="stylesheet" />

</head>

<body>
    <div class="page-bodys">

        <ul id="tabs-swipe-demo" class="tabs">
            <li class="tab col s3"><a href="#test-swipe-1" class="active" style="color:white;"><i class="material-icons">trending_up</i></a></li>
            <li class="tab col s3"><a href="#test-swipe-2" style="color:white;"><i class="material-icons">account_balance_wallet</i></a></li>
            <li class="tab col s3"><a href="#test-swipe-3" style="color:white;"><i class="material-icons">info_outline</i></a></li>
            <li class="tab col s3 right"><a href="#test-swipe-3" onclick="logout()" style="color:white;"><i class="material-icons">exit_to_app</i></a></li>

        </ul>
        <div id="test-swipe-1">

            <div class="row">
                <div class="col s10 m10 offset-m1 offset-s1">
                    <div class="card-panel " style="display:flex !important;flex-direction:column;justify-content:center !important;align-items:center !important;">
                        <span class="card-title" id="card-title1">Uso</span>
                        <div class="canvas-holder" id="canvas_div">
                            <canvas id="myChart"></canvas>
                        </div>
                        <div class="progress" style="background-color: grey !important; width: 50%;">
                            <div class="determinate" style="width: 50%;background-color:#6a1b9a !important;" id="valor-progresso"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col s10 m10 offset-m1 offset-s1">

                    <ul class="collapsible" data-collapsible="accordion">
                        <li>
                            <div class="collapsible-header " style="text-align:center"><i class="material-icons" style="color:#6a1b9a;">trending_up</i>Hist√≥rico
                                <a href="#" id="arrow" style="color: #6a1b9a !important"><i class="material-icons right">keyboard_arrow_down</i></a>
                            </div>
                            <div class="collapsible-body " id="card-graph">
                                <div class="line-holder">
                                    <div class="canvas-holder-line">
                                        <canvas id="lineChart"></canvas>

                                    </div>
                                </div>
                        </li>
                    </ul>
                    </div>
                </div>
            </div>
            <div id="test-swipe-2">

                <div class="card">
                    <div class="card-content" id="card-conta">
                        <span class="card-title activator grey-text text-darken-4" id="card-title1">Sua Conta</span>
                        <div class="response">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">supervisor_account</i>
                                <input id="conta" type="text" class="validate">
                                <label for="icon_prefix">Conta</label>
                            </div>
                            <div class="input-field col s4 offset-s4">
                                <i class="material-icons prefix"></i>
                                <button class="btn waves-effect waves-light" type="submit" name="action" id="submit-btn" onclick="getAccount()">Enviar<i class="material-icons right">send</i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card" id="card_do_saldo"></div>
            </div>
            <div id="test-swipe-3">
                <div class="card">
                    <div class="card-content" id="card-conta">
                        <span class="card-title activator grey-text text-darken-4" id="card-title1">Sua Conta</span>
                        <p class="z-depth-1" style="width: 150px !important;" id="valor_conta">Conta:
                            <a href="#" id="valor_conta"></a>
                        </p>
                    </div>
                </div>
                <div class="card" id="card-rate1"></div>
            </div>
        </div>

        <script src="/scripts/util.js"></script>
        <script src="/socket.io/socket.io.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.js"></script>
        <script src="/scripts/functions.js"></script>
        <script>
            $(document).ready(function () {
                var socket = io('http://localhost:3000');
                var mainframe = $("#valor-progresso");
                // socket.on('data', function () {
                //     // getMainFrameInfo();
                //     callProgress();
                //     callHistory();
                //     console.log('ta entrando pelo menos');
                // });

                // socket.on('history', function (data) {
                //     var valores = data;
                //     var points = valores.map(function (valor) {
                //         return valor[0] / 10;
                //     });
                //     var dates = valores.map(function (valor) {
                //         return valor[1]
                //     });
                //     drawLine(points, dates);
                // });

                // socket.on('progress', function (data) {
                //     var progress = data;
                //     // alert(progress);
                //     drawProgress(progress);
                // });

                callHistory();
                callProgress();

                function callHistory() {
                    xhrGet('/history', function (response) {
                        var valores = JSON.parse(response);
                        var points = valores.map(function (valor) {
                            return valor[0] / 10;
                        });
                        var dates = valores.map(function (valor) {
                            return valor[1]
                        });
                        drawLine(points, dates);
                        setTimeout(function () {
                            callHistory();
                        }, 180000);
                    }, function (err) {
                        console.log(err);
                    });

                }

                function callProgress() {
                    xhrGet('/progress', function (response) {
                        var progress = response;
                        drawProgress(progress);
                        setTimeout(function () {
                            callProgress();
                        }, 60000);
                    }, function (err) {
                        console.log(error);
                    });
                }
                // function getMainFrameInfo() {
                //     console.log("mainframe");
                //     // socket.emit('action', 'data');
                //     $.get('/info', function (data, status) {
                //         if (data.status) {
                //             var valor = (data.valor) / 10 || 0;
                //             x = valor;
                //             y = data.date;
                //             updateDraw(true);
                //         } else {
                //             alert(data.message);
                //         }
                //     });
                // }
                // getMainFrameInfo();
            });
        </script>
</body>

</html>